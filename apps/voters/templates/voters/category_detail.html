{% extends 'voters/base_voters.html' %}
{% load static %}

{% block content %}
<!-- Page Title with Breadcrumb -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">{{ category.name }}</h4>
            <div class="page-title-right d-none d-md-block">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="{% url 'voters:dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'voters:category_list' %}">Categories</a></li>
                    {% for ancestor in category.get_ancestors %}
                    <li class="breadcrumb-item"><a href="{% url 'voters:category_detail' ancestor.pk %}">{{ ancestor.name }}</a></li>
                    {% endfor %}
                    <li class="breadcrumb-item active">{{ category.name }}</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Stats Row -->
<div class="row g-3 mb-4">
    <div class="col-6 col-lg-3">
        <div class="stats-card">
            <div class="stats-icon primary">
                <i class="bx bx-folder"></i>
            </div>
            <div class="stats-value">{{ category.children.count }}</div>
            <div class="stats-label">Subcategories</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="stats-card">
            <div class="stats-icon success">
                <i class="bx bx-group"></i>
            </div>
            <div class="stats-value">{{ page_obj.paginator.count }}</div>
            <div class="stats-label">Total Voters</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="stats-card">
            <div class="stats-icon info">
                <i class="bx bx-layer"></i>
            </div>
            <div class="stats-value">{{ category.level }}</div>
            <div class="stats-label">Hierarchy Level</div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="stats-card">
            <div class="stats-icon {% if category.has_excel %}success{% else %}warning{% endif %}">
                <i class="bx bx-file"></i>
            </div>
            <div class="stats-value">{% if category.has_excel %}Yes{% else %}No{% endif %}</div>
            <div class="stats-label">Has Data</div>
        </div>
    </div>
</div>

<!-- Category Info & Actions -->
<div class="row g-4">
    <div class="col-lg-4">
        <!-- Category Info Card -->
        <div class="card-modern mb-4">
            <div class="card-header">
                <h5><i class="bx bx-info-circle me-2"></i>Category Details</h5>
            </div>
            <div class="card-body">
                <div class="voter-info-item">
                    <div class="voter-info-label">Name</div>
                    <div class="voter-info-value">{{ category.name }}</div>
                </div>
                <div class="voter-info-item">
                    <div class="voter-info-label">Code</div>
                    <div class="voter-info-value"><code class="bg-light px-2 py-1 rounded">{{ category.code|default:"-" }}</code></div>
                </div>
                <div class="voter-info-item">
                    <div class="voter-info-label">Full Path</div>
                    <div class="voter-info-value small text-muted">{{ category.full_path }}</div>
                </div>
                <div class="d-grid gap-2 mt-3">
                    <a href="{% url 'voters:voter_list' %}?category={{ category.pk }}" class="btn btn-primary btn-modern">
                        <i class="bx bx-search me-1"></i> Search in this Area
                    </a>
                    <a href="{% url 'voters:category_list' %}" class="btn btn-outline-secondary btn-modern">
                        <i class="bx bx-arrow-back me-1"></i> Back to Categories
                    </a>
                </div>
            </div>
        </div>

        <!-- Subcategories Card -->
        {% if category.children.exists %}
        <div class="card-modern">
            <div class="card-header">
                <h5><i class="bx bx-folder me-2"></i>Subcategories ({{ category.children.count }})</h5>
            </div>
            <div class="card-body p-0">
                <div class="category-tree">
                    {% for child in category.children.all %}
                    <div class="category-item">
                        <div class="category-info">
                            <div class="category-icon {% if child.has_excel %}has-excel{% else %}no-excel{% endif %}">
                                {% if child.has_excel %}<i class="bx bx-folder-open"></i>{% else %}<i class="bx bx-folder"></i>{% endif %}
                            </div>
                            <div>
                                <div class="category-name">{{ child.name }}</div>
                                {% if child.code %}<small class="text-muted">{{ child.code }}</small>{% endif %}
                            </div>
                        </div>
                        <a href="{% url 'voters:category_detail' child.pk %}" class="btn btn-icon btn-soft-primary">
                            <i class="bx bx-chevron-right"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Voters List -->
    <div class="col-lg-8">
        <div class="card-modern">
            <div class="card-header d-flex flex-wrap align-items-center justify-content-between gap-2">
                <h5 class="mb-0">
                    <i class="bx bx-user me-2"></i>ভোটার তালিকা / Voters
                    <span class="badge bg-primary ms-2">{{ page_obj.paginator.count }}</span>
                </h5>
                <span class="text-muted small">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </div>
            <div class="card-body p-0">
                {% if voters %}
                <!-- Desktop Table -->
                <div class="table-responsive-modern d-none d-md-block">
                    <table class="table table-modern mb-0">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name / নাম</th>
                                <th>Voter No</th>
                                <th>Gender</th>
                                <th>View</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for voter in voters %}
                            <tr>
                                <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
                                <td><strong class="text-dark">{{ voter.name|default:"-" }}</strong></td>
                                <td><code class="bg-light px-2 py-1 rounded">{{ voter.voter_no|default:"-" }}</code></td>
                                <td>
                                    {% if voter.gender == 'male' %}
                                    <span class="badge-gender male">পুরুষ</span>
                                    {% elif voter.gender == 'female' %}
                                    <span class="badge-gender female">মহিলা</span>
                                    {% else %}
                                    <span class="badge-gender unknown">N/A</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'voters:voter_detail' voter.pk %}" class="btn btn-icon btn-soft-primary">
                                        <i class="bx bx-show"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Cards -->
                <div class="d-md-none p-3">
                    {% for voter in voters %}
                    <div class="card mb-2 shadow-sm">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-1">{{ voter.name|default:"-" }}</h6>
                                    <code class="small">{{ voter.voter_no|default:"-" }}</code>
                                </div>
                                {% if voter.gender == 'male' %}
                                <span class="badge-gender male">পুরুষ</span>
                                {% elif voter.gender == 'female' %}
                                <span class="badge-gender female">মহিলা</span>
                                {% else %}
                                <span class="badge-gender unknown">N/A</span>
                                {% endif %}
                            </div>
                            <a href="{% url 'voters:voter_detail' voter.pk %}" class="btn btn-sm btn-outline-primary w-100">
                                <i class="bx bx-show me-1"></i> View Details
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                <div class="p-3 border-top">
                    <nav>
                        <ul class="pagination pagination-modern justify-content-center mb-0">
                            {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1" title="First">
                                    <i class="bx bx-chevrons-left"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" title="Previous">
                                    <i class="bx bx-chevron-left"></i>
                                </a>
                            </li>
                            {% endif %}
                            <li class="page-item active">
                                <span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
                            </li>
                            {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}" title="Next">
                                    <i class="bx bx-chevron-right"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" title="Last">
                                    <i class="bx bx-chevrons-right"></i>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="bx bx-user-x"></i>
                    </div>
                    <h5>No voters in this category</h5>
                    <p>Check subcategories or import data for this area.</p>
                    {% if category.children.exists %}
                    <a href="#" class="btn btn-outline-primary btn-modern" onclick="document.querySelector('.card-modern:last-child').scrollIntoView({behavior: 'smooth'}); return false;">
                        <i class="bx bx-folder me-1"></i> View Subcategories
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
